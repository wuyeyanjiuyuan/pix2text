  <title>午夜研究院</title>
  <link rel="icon" href="images/icon.ico" sizes="16x16">

  <!-- 样式 -->
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/search-form.css">
  <link rel="stylesheet" href="./live2d/assets/waifu.css" />
  <!-- 不再需要 loading.css，如果里面有 .module {opacity:0} 就别引入了 -->
  <!-- <link rel="stylesheet" href="css/loading.css"> -->

  <!-- jQuery -->
  <script src="live2d/assets/jquery.min.js"></script>
  <script src="live2d/assets/jquery-ui.min.js"></script>

  <!-- 禁止转码 -->
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
</head>

<body>
  <!-- 顶部导航 -->
  <header class="navbar">
  <!-- 左侧：logo + 导航 -->
  <div class="navbar-main">
    <div class="logo">
      <a href="https://wuyeyanjiuyuan.github.io/">
        <img src="images/logo.png" alt="午夜研究院 Logo">
      </a>
    </div>

    <nav class="nav-links">
      <a href="https://wuyeyanjiuyuan.github.io/pix2text" target="_blank">Pix2Text</a>
      <a href="https://space.bilibili.com/13308970" target="_blank">Bilibili</a>
      <a href="https://www.cnki.net/" target="_blank">CNKI</a>
    </nav>
  

  <!-- 右侧：搜索模块 -->
  <div id="module-search"></div>
  </div>
</header>

<!-- 主体区域：一个大卡片装 Pix2Text 工具 -->
<main id="main-container">
        <section class="tool-card">
    <!----------------------------------Pix2text--------------------------------------->
    <div class="container">
        <div class="left-panel">
            <div id="imageDisplay">
                上传的图片将显示在这里
            </div>
            <input type="file" id="imageInput" class="button" onchange="previewImage();" />
        </div>
    
        <div class="center-panel">
            <button class="button" onclick="recognizeImage();">➡️ 识别</button>
        </div>
    
        <div class="right-panel">
            <textarea id="textOutput">识别的文本将显示在这里</textarea>
            <button class="button" onclick="copyText();">复制</button>
        </div>
    </div>
</main>

    <script>
    function previewImage() {
        var display = document.getElementById('imageDisplay');
        display.innerHTML = ''; // 清除旧的预览
        var reader = new FileReader();
        reader.onload = function(e) {
            var img = new Image();
            img.src = e.target.result;
            img.onload = function() {
                display.appendChild(img);
            }
        };
        reader.readAsDataURL(document.getElementById('imageInput').files[0]);
    }
    
    async function recognizeImage() {
        const image = document.getElementById('imageInput').files[0];
        const outputArea = document.getElementById('textOutput');

        if (image) {
            // Clear previous text
            outputArea.value = 'Recognizing...';

            const worker = Tesseract.createWorker({
                logger: m => console.log(m)
            });

            try {
                await worker.load();
                await worker.loadLanguage('eng');
                await worker.initialize('eng');

                const { data: { text } } = await worker.recognize(image);
                outputArea.value = text;
            } catch (error) {
                console.error('OCR Error:', error);
                outputArea.value = 'Failed to recognize text. Please try again.';
            }

            await worker.terminate();
        }
    }
    
    function copyText() {
        var textOutput = document.getElementById('textOutput');
        textOutput.select();
        document.execCommand('copy');
    }
    </script>
    <!-- Live2D 模块（内容里有 waifu，依旧固定在右下角） -->
  <div id="module-live2d"></div>

  <!-- 其它 JS 特效（点击飘字等），只包含 <script> 的模块 -->
  <div id="module-effects"></div>

  <!-- 页脚 -->
  <footer class="footer">
    <p>Copyright &copy; 2025 午夜研究院 | 保留所有权利</p>
  </footer>

  <!-- 模块加载逻辑（无动画） -->
  <script>
    $(function(){
      // 如果 modules 放在 /modules/ 目录下就用下面这版路径
      const modules = {
        "#module-search":   "./modules/search.html",
        "#module-live2d":   "./modules/live2d.html",
        "#module-effects":  "./modules/effects.html"
      };

      for (let id in modules) {
        $(id).load(modules[id], function(response, status, xhr){
          if (status === "error") {
            console.error("模块加载失败：", id, modules[id], xhr.status, xhr.statusText);
          }
        });
      }
    });
  </script>

</body>
</html>
