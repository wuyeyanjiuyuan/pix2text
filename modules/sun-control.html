<style>
    /* 容器样式保持不变 */
    #sun-interaction-container {
        position: relative; width: 100%; height: 600px;
        background: #000; border-radius: 12px; overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    #three-canvas { width: 100%; height: 100%; display: block; }
    
    .ui-overlay {
        position: absolute; top: 20px; left: 20px; z-index: 10;
        color: white; font-family: 'Segoe UI', sans-serif;
        text-shadow: 0 1px 3px rgba(0,0,0,0.8); pointer-events: none;
    }
    .status-badge {
        display: inline-block; padding: 6px 12px;
        background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.3);
        border-radius: 20px; backdrop-filter: blur(4px);
        font-size: 14px; margin-bottom: 10px; color: #ffd700; transition: all 0.3s;
    }
    .cam-preview {
        position: absolute; bottom: 20px; right: 20px;
        width: 120px; height: 90px; border-radius: 8px; overflow: hidden;
        border: 2px solid rgba(255,255,255,0.5); z-index: 10; background: #000;
    }
    #input-video { position: absolute; opacity: 0; pointer-events: none; }
    #output-canvas { width: 100%; height: 100%; transform: scaleX(-1); }
</style>

<div id="sun-interaction-container">
    <div class="ui-overlay">
        <div id="status-text" class="status-badge">正在初始化物理大气引擎...</div>
        <div style="font-size:12px; opacity:0.9">✋ 张开：旭日金光 | ✊ 握拳：夕阳橘红</div>
    </div>

    <div class="cam-preview"><canvas id="output-canvas"></canvas></div>
    <video id="input-video" playsinline></video>
    <div id="three-canvas"></div>
</div>

<script src="js/three.min.js"></script>
<script src="js/camera_utils.js"></script>
<script src="js/control_utils.js"></script>
<script src="js/drawing_utils.js"></script>
<script src="js/hands.js"></script>

<script src="js/Water.js"></script>
<script src="js/Sky.js"></script>

<script>
    const statusText = document.getElementById('status-text');

    // 生成海面纹理 (保持不变)
    function createWaterNormalTexture() {
        const size = 512;
        const canvas = document.createElement('canvas');
        canvas.width = size; canvas.height = size;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#8080ff'; 
        ctx.fillRect(0, 0, size, size);
        for (let i = 0; i < 20000; i++) {
            const x = Math.random() * size;
            const y = Math.random() * size;
            const r = Math.random() * 2 + 1;
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(${128 + Math.random()*127}, ${128 + Math.random()*127}, 255, 0.5)`;
            ctx.fill();
        }
        const texture = new THREE.CanvasTexture(canvas);
        texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
        return texture;
    }

    // ★★★ 创建光晕纹理 (调整了渐变，让边缘更柔和) ★★★
    function createGlowTexture() {
        const canvas = document.createElement('canvas');
        canvas.width = 128; canvas.height = 128;
        const ctx = canvas.getContext('2d');
        const gradient = ctx.createRadialGradient(64,64,0, 64,64,64);
        // 内圈稍硬，外圈极柔
        gradient.addColorStop(0, 'rgba(255, 255, 255, 1)'); 
        gradient.addColorStop(0.3, 'rgba(255, 255, 255, 0.8)'); 
        gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.2)'); 
        gradient.addColorStop(1, 'rgba(0, 0, 0, 0)'); 
        ctx.fillStyle = gradient;
        ctx.fillRect(0,0,128,128);
        return new THREE.CanvasTexture(canvas);
    }

    try {
        if (!THREE.Water || !THREE.Sky) {
            throw new Error("请确保 js 文件夹内包含 Water.js 和 Sky.js");
        }

        const container = document.getElementById('three-canvas');
        const width = container.clientWidth;
        const height = container.clientHeight;

        const scene = new THREE.Scene();

        const camera = new THREE.PerspectiveCamera(55, width / height, 1, 20000);
        camera.position.set(30, 30, 100);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(width, height);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.outputEncoding = THREE.sRGBEncoding;
        // ★★★ 初始曝光度调低一点，配合夕阳氛围 ★★★
        renderer.toneMappingExposure = 0.5; 
        container.appendChild(renderer.domElement);

        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();

        // --- 海洋 ---
        const waterGeometry = new THREE.PlaneGeometry(10000, 10000);
        const water = new THREE.Water(
            waterGeometry,
            {
                textureWidth: 512,
                textureHeight: 512,
                waterNormals: createWaterNormalTexture(),
                sunDirection: new THREE.Vector3(),
                sunColor: 0xffffff,
                waterColor: 0x001e0f,
                distortionScale: 3.7,
                fog: scene.fog !== undefined
            }
        );
        water.rotation.x = - Math.PI / 2;
        scene.add(water);

        // --- 天空 ---
        const sky = new THREE.Sky();
        sky.scale.setScalar(10000);
        scene.add(sky);

        const skyUniforms = sky.material.uniforms;
        skyUniforms['mieCoefficient'].value = 0.005; 
        skyUniforms['mieDirectionalG'].value = 0.8;

        // --- 太阳对象 ---
        const sun = new THREE.Vector3();

        // 1. 太阳内核 (实体球) - 用来表现“金黄”
        const sunGeometry = new THREE.SphereGeometry(60, 32, 32); 
        const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffaa00 });
        const sunSphere = new THREE.Mesh(sunGeometry, sunMaterial);
        scene.add(sunSphere);

        // 2. 太阳外晕 (Sprite) - 用来表现“橘红”
        // 放在太阳后面一点点，防止渲染层级闪烁
        const glowMaterial = new THREE.SpriteMaterial({ 
            map: createGlowTexture(), 
            color: 0xff4400, 
            transparent: true, 
            blending: THREE.AdditiveBlending,
            opacity: 1.0,
            depthWrite: